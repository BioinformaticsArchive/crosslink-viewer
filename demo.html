<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>xiNET cross-link viewer | Demo</title>

        <link rel="stylesheet" href="./demo.css">
        <link rel='stylesheet' type='text/css' href='./XLV.css'/>
        <!--libraries-->
        <script type="text/javascript" src="./lib/d3.v3.js"></script>
        <script type="text/javascript" src="./lib/colorbrewer.js"></script>
        <script type="text/javascript" src="./lib/jsdas.js"></script>
        <script type="text/javascript" src="./lib/rgbcolor.js"></script>
        <!--xiNet-->
        <script type="text/javascript" src="./controller/Init.js"></script>
        <script type="text/javascript" src="./controller/MouseEvents.js"></script>
        <script type="text/javascript" src="./controller/Layout.js"></script>
        <script type="text/javascript" src="./controller/Refresh.js"></script>
        <script type="text/javascript" src="./controller/ToolTips.js"></script>
        <script type="text/javascript" src="./model/Match.js"></script>
        <script type="text/javascript" src="./model/Link.js"></script>
        <script type="text/javascript" src="./model/Protein.js"></script>
        <script type="text/javascript" src="./model/Annotations.js"></script>
        <script type="text/javascript" src="./model/ProteinLink.js"></script>
        <script type="text/javascript" src="./model/ResidueLink.js"></script>
        <script type="text/javascript" src="./model/SequenceDatum.js"></script>
        <script type="text/javascript" src="./controller/ExternalControls.js"></script>
        <script type="text/javascript" src="./Rotator.js"></script>
        <!--<script type="text/javascript" src="./InfoBox.js"></script>-->
        <script type="text/javascript" src="./DASUtil.js"></script>
        <script type="text/javascript" src="./ReadCSV.js"></script>
        <!--data-->
    </head>
    <body>

        <div style="height:100%;">
            <!--TODO: change exportSVG so param not needed?-->
			<button onclick="help()">HELP</button>
			<button type='button' id='exportSVG'  onclick="xlv.exportSVG('networkSVG');">Export SVG</button>
            
            <button type="button" id="autoLayout" onclick="xlv.autoLayout();">Auto</button>
            <button type="button" id="resetViewport" onclick="xlv.resetZoom();">Reset zoom</button>
      
			<p>Data from <a target="_blank" href="http://www.sciencemag.org/content/337/6100/1348">Herzog, F. et al. Structural Probing of a Protein Phosphatase 2A Network by Chemical Cross-Linking and Mass Spectrometry. Science 337, 1348â€“1352 (2012).</a></p>

            <div id="networkContainer"></div>
            <div id="networkCaption"><p style="width:100%;text-align: center;"><strong>DOUBLE CLICK interactors to toggle between blob and stick</strong></p></div>
        </div>

        <script type="text/javascript">
		var holder = document.getElementById('networkContainer');
		holder.ondragover = function () { this.className = 'hover'; return false; };
holder.ondragend = function () { this.className = ''; return false; };
		holder.ondrop = function (e) {
  e.preventDefault();

  var file = e.dataTransfer.files[0];
var targetDiv = document.getElementById('networkContainer');
                var messageDiv = document.getElementById('networkCaption');
                xlv = new xinet.Controller(targetDiv);
                xlv.setMessageElement(messageDiv);
				d3.text(file, "text/csv", function(text) {
					xlv.readCSV(text);
					new xinet.DASUtil(xlv);
				});
  return false;
};
holder.ondrop = function (e) {
  this.className = '';
  e.preventDefault();

  var file = e.dataTransfer.files[0],
      reader = new FileReader();
  reader.onload = function (event) {
    console.log(event.target);
	var targetDiv = document.getElementById('networkContainer');
                var messageDiv = document.getElementById('networkCaption');
                xlv = new xinet.Controller(targetDiv);
                xlv.setMessageElement(messageDiv);
				d3.text(event.target.result, "text/csv", function(text) {
					xlv.readCSV(text);
					new xinet.DASUtil(xlv);
				});
  };
  console.log(file);
  reader.readAsDataURL(file);

  return false;
};
                //<![CDATA[
                
                //]]>
        </script>

    </body></html>
