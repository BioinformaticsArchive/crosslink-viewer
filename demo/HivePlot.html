<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  fill: none;
  stroke-width: 1.5px;
}

.axis, .node {
  stroke: #000;
  stroke-width: 1.5px;
}

</style>
<body>
<script type="text/javascript" src="../src/controller/xiNET_Storage.js"></script>
<script type="text/javascript" src="../vendor/d3.js"></script>
<script type="text/javascript" src="../vendor/hive.js"></script>
<script>
	
	"use strict";

//	var color = d3.scale.category20();

	var width = document.documentElement.clientWidth * 0.9,
	height = document.documentElement.clientHeight * 0.9,
	smallestDimension = (width < height)? width:height,
	innerRadius = 40,
    outerRadius = (smallestDimension / 2) - 20;

var angle = d3.scale.ordinal().domain(d3.range(4)).rangePoints([0, 2 * Math.PI]),
    radius = d3.scale.linear().range([innerRadius, outerRadius]),
    color = d3.scale.category10().domain(d3.range(20));

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
	.append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");



d3.csv("./data/tfiif_highConf.csv", function (parsedCSV){	

	var proteinSequences = d3.map();
	
	var rowCount = parsedCSV.length;
	for (var r = 0; r < rowCount; r++) {
		var row = parsedCSV[r];
		var id1 = row.Protein1;
		if (id1.indexOf('|') !== -1){
			id1 = id1.split('|')[1];
		}
		var id2 = row.Protein1;
		if (id2.indexOf('|') !== -1){
			id2 = id2.split('|')[1];
		}
		proteinSequences.set(id1, '');
		proteinSequences.set(id2, '');
	}
	
	var proteinIDs = proteinSequences.keys();
	var proteinCount = proteinIDs.length;
	var retrievedCount = 0;
	
	for (var p = 0; p < proteinCount; p++ ) {
		var id = proteinIDs[p];
		
		xiNET_Storage.getSequence(id, function (acc, sq){
			retrievedCount++;
			proteinSequences.set(acc, sq);
			if (retrievedCount === proteinCount){
				//we're done getting sequence info, init fig
				console.log(proteinSequences);
				
				
				
			}	
		});
	}
});	
	
	//~ var ni = 0;
	//~ var nodeLookup = d3.map();
	//~ var nodeArray = nodeSet.values();
	
	//~ var nodes = new Array();
	
	//~ var nodeCount = nodeArray.length;
	//~ for (var n = 0; n < nodeCount; n++){
			//~ nodeLookup.set(nodeArray[n] + "_" + m, ((n * 200) + m));
			//~ nodes.push({
					//~ name:nodeArray[n] + "_" + m,
					//~ x: n * 60,
					//~ y: m*2,
					//~ px: n * 60,
					//~ py: m*2
					//~ });
	//~ }
	//~ 
	//~ var links = [];
	//~ for (var n = 0; n < linkedResCount; n++){
			//~ for (var m = 0; m < 199; m ++) {
					//~ var linkObj = {};
					//~ linkObj.source =  nodeLookup.get(nodeArray[n] + "_" + m);
					//~ linkObj.target =  nodeLookup.get(nodeArray[n] + "_" + ((m * 1) + 1));
					//~ linkObj.id = linkObj.source + "_to_" + linkObj.target;
					//~ links.push(linkObj);
			//~ }
	//~ }

	
	//~ console.log(JSON.stringify(nodeLookup));
	//~ console.log(JSON.stringify(nodes));


var nodes = [
  {x: 0, y: .1},
  {x: 0, y: .9},
  {x: 1, y: .2},
  {x: 1, y: .3},
  {x: 2, y: .1},
  {x: 2, y: .8}
];

var links = [
  {source: nodes[0], target: nodes[2]},
  {source: nodes[1], target: nodes[3]},
  {source: nodes[2], target: nodes[4]},
  {source: nodes[2], target: nodes[5]},
  {source: nodes[3], target: nodes[5]},
  {source: nodes[4], target: nodes[0]},
  {source: nodes[5], target: nodes[1]}
];


svg.selectAll(".axis")
    .data(d3.range(3))
  .enter().append("line")
    .attr("class", "axis")
    .attr("transform", function(d) { return "rotate(" + degrees(angle(d)) + ")"; })
    .attr("x1", radius.range()[0])
    .attr("x2", radius.range()[1]);

svg.selectAll(".link")
    .data(links)
  .enter().append("path")
    .attr("class", "link")
    .attr("d", d3.hive.link()
    .angle(function(d) { return angle(d.x); })
    .radius(function(d) { return radius(d.y); }))
    .style("stroke", function(d) { return color(d.source.x); });

svg.selectAll(".node")
    .data(nodes)
  .enter().append("circle")
    .attr("class", "node")
    .attr("transform", function(d) { return "rotate(" + degrees(angle(d.x)) + ")"; })
    .attr("cx", function(d) { return radius(d.y); })
    .attr("r", 5)
    .style("fill", function(d) { return color(d.x); });

function degrees(radians) {
  return radians / Math.PI * 180 - 90;
}

</script>
