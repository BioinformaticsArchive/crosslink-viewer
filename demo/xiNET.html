<!DOCTYPE html>
<!-- saved from url=(0071)http://129.215.14.125/searches/ppi.php?sid=1645-86965-24875-51879-16266 -->
<html>   
 <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>xiNET | Rappsilber Laboratory</title>
		<link rel="stylesheet" href="./css/xiNET.css">
		<link rel="stylesheet" href="./css/bootstrap.css">
		<link rel="stylesheet" href="./css/flat-ui.css" >
		<link rel="stylesheet" href="./css/demo.css">
        <!--libraries-->
        <script type="text/javascript" src="./lib/d3.js"></script>
        <script type="text/javascript" src="./lib/colorbrewer.js"></script>
        <script type="text/javascript" src="./lib/jsdas.js"></script>
        <script type="text/javascript" src="./lib/rgbcolor.js"></script>
        <script type="text/javascript" src="./lib/prototype.js"></script>
        <script type="text/javascript" src="./lib/slider.js"></script>
        <!--xiNET-->
        <script type="text/javascript" src="./js/controller/Init.js"></script>
        <script type="text/javascript" src="./js/controller/MouseEvents.js"></script>
        <script type="text/javascript" src="./js/controller/Layout.js"></script>
        <script type="text/javascript" src="./js/controller/Refresh.js"></script>
        <script type="text/javascript" src="./js/controller/ToolTips.js"></script>
        <script type="text/javascript" src="./js/model/Match.js"></script>
        <script type="text/javascript" src="./js/model/Link.js"></script>
        <script type="text/javascript" src="./js/model/Protein.js"></script>
        <script type="text/javascript" src="./js/model/Annotations.js"></script>
        <script type="text/javascript" src="./js/model/ProteinLink.js"></script>
        <script type="text/javascript" src="./js/model/ResidueLink.js"></script>
        <script type="text/javascript" src="./js/controller/ExternalControls.js"></script>
        <script type="text/javascript" src="./js/model/Rotator.js"></script>
        <script type="text/javascript" src="./js/controller/DASUtil.js"></script>
        <script type="text/javascript" src="./js/controller/ReadCSV.js"></script>
    </head>
    <body>
	<div id="outerDiv">
			<div class="controls">
				<button class="btn btn-inverse help" onclick="toggleHelpPanel()">Help</button>
				<button class="btn info" onclick="toggleInfoPanel()">Selection</button>
				<button class="btn btn-inverse exportsvg" onclick="xlv.exportSVG(&#39;networkSVG&#39;);">Export</button>
				<button class="btn btn-inverse autolayout" onclick="xlv.autoLayout();">Auto</button>
				<button class="btn btn-inverse resetzoom" onclick="xlv.resetZoom();">Reset</button>		
				<button class="btn btn-inverse saveLayout" onclick="xlv.saveLayout();">Save</button>		
				
				<div class="controlGroup">
                    <p class="scoreLabel">A&nbsp;<input checked="checked" id="manualA" onclick="PV.hideA = (!document.getElementById(&#39;manualA&#39;).checked); xlv.checkLinks();" type="checkbox"></p>
                    <p class="scoreLabel">B&nbsp;<input checked="checked" id="manualB" onclick="PV.hideB = (!document.getElementById(&#39;manualB&#39;).checked); xlv.checkLinks();" type="checkbox"></p>
                    <p class="scoreLabel">C&nbsp;<input checked="checked" id="manualC" onclick="PV.hideC = (!document.getElementById(&#39;manualC&#39;).checked); xlv.checkLinks();" type="checkbox"></p>
                    <p class="scoreLabel">?&nbsp;<input checked="checked" id="manualQ" onclick="PV.hideQ = (!document.getElementById(&#39;manualQ&#39;).checked); xlv.checkLinks();" type="checkbox"></p>
                </div>
				
				<div class="controlGroup" id="scoreSlider" style="width:500px">
					<p class="scoreLabel">Auto&nbsp;<input checked="checked" id="autoTrue" onclick="PV.hideAUTOTRUE = (!document.getElementById(&#39;autoTrue&#39;).checked); xlv.checkLinks();" type="checkbox"></p>
					<p class="scoreLabel" id="scoreLabel1">1.13</p>
					<div id="track1" class="sliderbar">
						<div class="selected" id="handle1" style="left: 0px;"></div> 
					</div>
					<p class="scoreLabel" id="scoreLabel2">2.13&nbsp;&nbsp;</p>
					<p id="debug1">Cut-Off:1.13</p>
				</div>
				
				<div class="controlGroup"><p>Self&nbsp;
					<input checked="checked" id="internal" onclick="xlv.hideInternal(!document.getElementById(&#39;internal&#39;).checked)" type="checkbox"></p>
				</div>
				
				 <div class="controlGroup"><p>Ambig.&nbsp;
					<input checked="checked" id="ambig" onclick="xlv.hideAmbig(!document.getElementById(&#39;ambig&#39;).checked)" type="checkbox"></p>
                </div>
			</div>
<!--
						<button type="button" id="linkInfo" onclick="PV_linkInfo()">
                            Link summary
                        </button>
                        <button type="button" id="linkInfo" onclick="PV_residueInfo()">
							Residue summary
                        </button>
-->					
			<div id="networkContainer"></div>
				
			<div class="overlay-box" id="infoPanel" style="display: block; top: 0%;">
				<div>
					<h4>Selection Details:</h4>
					<div id="networkCaption"></div>
				</div>
			</div>
			<div class="overlay-box" id="helpPanel">
				<div>
					<h4>Help:</h4>	
					<table class="hor-minimalist-a" bordercolor="#eee">
						<tbody><tr>
							<td>Toggle the proteins between a bar and a circle</td>
							<td>Double-click on protein</td>
						</tr>
						<tr>
							<td>Zoom</td>
							<td>Mouse wheel</td>
						</tr>
						<tr>
							<td>Pan</td>
							<td>Click and drag on background</td>
						</tr>
						<tr>
							<td>Move protein</td>
							<td>Click and drag on protein</td>
						</tr>
						<tr>
							<td>Expand bar <br>(increases bar length until sequence is visible)</td>
							<td>Shift_left-click on protein</td>
						</tr>
						<tr>
							<td>Rotate bar</td>
							<td>Click and drag on handles that appear at end of bar</td>
						</tr>
						<tr>
							<td>Hide/show protein (and all links to it)</td>
							<td>Right-click on protein</td>
						</tr>
						<tr>
							<td>Hide/show links between two specific proteins</td>
							<td>Right click on any link between those proteins</td>
						</tr>
						<tr>
							<td>'Flip' side of bar on which internal links are shown</td>
							<td>Right-click on internal link</td>
						</tr>
					</tbody></table> 
					<p>&nbsp;</p>
					<p>Tip: To change the size of proteins in relation to the size of
						 the page press Ctrl/- or Ctrl/+. 
						 (This zooms the browser, on a Mac its Cmd/- or Cmd/+.) 
					</p>
				</div>
			</div>	
		</div>

            <script type="text/javascript">//<![CDATA[
	var targetDiv = document.getElementById('networkContainer');
	var messageDiv = document.getElementById('networkCaption');
	xlv = new xinet.Controller(targetDiv);
	xlv.setMessageElement(messageDiv);
	xlv.cutOff = 0;
    //
    //    jQuery.noConflict();
    //
    // horizontal slider control
    new Control.Slider('handle1', 'track1', {sliderValue: 0,
        onSlide: function(v) {
            $('debug1').innerHTML = 'cut-off: ' + roundNumber(v * 15, 1);
            xlv.setCutOff(roundNumber(v * 15, 1));
        },
        onChange: function(v) {
            $('debug1').innerHTML = 'cut-off: ' + roundNumber(v * 15, 1);
            xlv.setCutOff(roundNumber(v * 15, 1));
        }
    });
    function roundNumber(num, dec) {
        var result = Math.round(num * Math.pow(10, dec)) / Math.pow(10, dec);
        return result;
    }
    PV = {};
    PV.hideA = false;
    PV.hideB = false;
    PV.hideC = false;
    PV.hideQ = false;
    PV.hideAUTOTRUE = false;
    
    xlv.filter = function (match) {
		var vChar = match.validated.toUpperCase()[0];
		if (vChar == 'A' && !PV.hideA) return true;
		else if (vChar == 'B' && !PV.hideB) return true;
		else if (vChar == 'C' && !PV.hideC) return true;
		else if (vChar == '?' && !PV.hideQ) return true;
		else{
			if (match.autovalidated){
				if (!PV.hideAUTOTRUE && (match.score >= xlv.cutOff))  return true;
			}
		//        else {
		//            if (!PV.hideAUTOFALSE && (this.score >= PV.cutOff))  return true;
		//            }
		//            }
		}
		return false;
	}
	
xlv.sid = "1645";//SELECT has_protein.peptide_id, has_protein.protein_id, peptide_position INTO TEMPORARY tempHasProtein109_145_170_137_1384810928 FROM has_protein, tempMatchedPeptides109_145_170_137_1384810928 WHERE tempMatchedPeptides109_145_170_137_1384810928.peptide_id = has_protein.peptide_id GROUP BY  has_protein.peptide_id, has_protein.protein_id, peptide_position;
//SELECT t1.layout AS l  FROM layouts AS t1  LEFT OUTER JOIN layouts AS t2  ON (t1.search_id = t2.search_id AND t1.time &lt; t2.time)  WHERE t1.search_id = 1645 AND t2.search_id IS NULL;
xlv.addProtein (657148,'','VDGCMDPEPIVRIVGRNGLCVDVRDGRFHNGNAIQLWPCKSNTDANQLWTLKRDNTIRSNGKCLTTYGYSPGVYVMIYDCNTAATDATRWQIWDNGTIINPRSSLVLAATSGNSGSTLTVQTNIYVLSQGWLPTNNTQPFVTTIVGLYGLCLQANSGQVWLEDCTSEKAEQQWALYADGSIRPQQNRDNCLTSDSNIQGTVVKILSCGPASSGQRWMFKNDGTILNLYNGLVLDVRASDPSLKQIILHPFHGDPNQIWLPLL','B','ricin','262');
xlv.addProtein (657149,'','EVQLQQSGAELMKPGASVKISCNGTGYTFSNYWIEWIKQRPGHGLEWIGEILPGSDITYYNEKFKGKATFTADTSSSTVYMKLISLTSEDSAVYFCARDAWFAYWGQGTLVTVS','chain','R109','114');
xlv.addProtein (657153,'','DILMTQSPAILSVSPGERVSFSCRASQSIGTSIHWYQQRTNGSPRLLIKYASESFSGIPSRFSGSGSGTDFTLSINSVESEDIADYYCQQSNSWPYTFGGGTKLEIKR','chain','R109','108')

xlv.addMatch("657148",[187],"657148",[40],116379394,2.1314209030784963,16,1,"DNCLTSDSNIQGTVVKILSCGPASbs3-d4nh2SGQR","SNTDANQLWTLKbs3-d4nh2RDNTbs3-d4nh2IR",'f','?','');
xlv.addMatch("657148",[58],"657148",[52],116379116,1.5808837792228199,4,4,"SNGKCLTTYGYSPGVYVMIYbs3-d4nh2DCNTAATDATR","RDNTIR",'f','?','');
xlv.addMatch("657148",[16],"657148",[52],116379243,1.4773072169748733,36,4,"NGLCVDVRDGRFHNGNAIQLWPCKSNTDANQLWTbs3-d4nh2LKR","RDNTIR",'f','?','');
xlv.addMatch("657148",[187],"657148",[58],116379436,1.402970835710396,13,1,"DNCcmLTSDSNIQGTVVK","SNGK",'f','?','');
xlv.addMatch("657153",[49],"657153",[18],116379435,1.3059620754359524,11,2,"YASESFSGIPSR","VSFSbs3-d4nh2CR",'f','?','');
xlv.addMatch("657148",[187],"657148",[236],116379547,1.3058206621018362,8,5,"DNCLTSbs3-d4ohDSNIQGTVVK","ASbs3-d4ohDPSLK",'f','?','');
xlv.addMatch("657148",[187],"657148",[236],116379548,1.3058206621018362,8,5,"DNCLTbs3-d4ohSDSNIQGTVVK","ASbs3-d4ohDPSLK",'f','?','');
xlv.addMatch("657153",[0],"657153",[39],116379139,1.282399685751088,1,1,"DILMTQSPAILSVSPGERVSFSCRASQSIGTSbs3-d4ohIHWYQQR","TNGSbs3-d4ohPR",'f','?','');
xlv.addMatch("657148",[168],"657148",[52],116379437,1.1914947548519317,8,4,"AEQQWALYADGSbs3-d4ohIRPQQNR","RDNTIR",'f','?','');
xlv.addMatch("657153",[18],"657149",[82],116379111,1.1627599932918278,4,5,"VSFSCcmR","LISLTSEDSbs3-d4ohAVYFCAR",'f','?','');
xlv.addMatch("657148",[53],"657148",[203],116379440,1.158706363654232,6,3,"DNTIRSNGK","ILSCGPASSGQRWMoxFK",'f','?','');
xlv.addMatch("657148",[40],"657148",[53],116379573,1.1260699277415358,1,6,"SNTbs3-d4ohDANQLWTLK","DNTbs3-d4ohIRSNGK",'f','?','');
   // synchFilters();


    xlv.init();

    function PV_savePVLayout() {
        var layout = PV_getPVLayout();
        var dateString = getDateString();
        PV.message("layout sent:" + layout, true);
        var defaultDesc = "Layout for search " + PV.sid + ", " + dateString;
        var desc = prompt("Enter description of layout:", defaultDesc);

        var xmlhttp;
        if (window.XMLHttpRequest)
        {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        }
        else
        {// code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        var url = "saveLayout.php";
        var params = "sid=" + PV.sid + "&layout=" + encodeURIComponent(layout) + "&desc=" + desc;
        xmlhttp.open("POST", url, true);

        //Send the proper header information along with the request
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //chrome doesn't like following
        //  xmlhttp.setRequestHeader("Content-length", params.length);
        //    xmlhttp.setRequestHeader("Connection", "close");

        xmlhttp.onreadystatechange = function() {//Call a function when the state changes.
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                PV.message("response:" + xmlhttp.responseText, true);
            }
        }
        xmlhttp.send(params);

        function getDateString() {
            var d_names = new Array("Sunday", "Monday", "Tuesday",
                    "Wednesday", "Thursday", "Friday", "Saturday");
            var m_names = new Array("January", "February", "March",
                    "April", "May", "June", "July", "August", "September",
                    "October", "November", "December");
            var d = new Date();
            var curr_day = d.getDay();
            var curr_date = d.getDate();
            var sup = "";
            if (curr_date == 1 || curr_date == 21 || curr_date == 31) {
                sup = "st";
            }
            else if (curr_date == 2 || curr_date == 22) {
                sup = "nd";
            }
            else if (curr_date == 3 || curr_date == 23) {
                sup = "rd";
            }
            else {
                sup = "th";
            }
            var curr_month = d.getMonth();
            var curr_year = d.getFullYear();
            var curr_hour = d.getHours();
            if (curr_hour < 12) {
                a_p = "AM";
            }
            else {
                a_p = "PM";
            }
            if (curr_hour == 0) {
                curr_hour = 12;
            }
            if (curr_hour > 12) {
                curr_hour = curr_hour - 12;
            }
            var curr_min = d.getMinutes();
            curr_min = curr_min + "";
            if (curr_min.length == 1) {
                curr_min = "0" + curr_min;
            }
            return d_names[curr_day] + " " + curr_date + sup + " " + m_names[curr_month]
                    + " " + curr_year + ", " + curr_hour + ":" + curr_min + " " + a_p;
        }
    }

    function PV_linkInfo() {

        if (PV.set1 !== undefined) {
            var set1Links = [];
            var set2Links = [];
            var set3Links = [];
            var nonuniqueLinks = [];

            var links = XiPV.proteinLinks.values();
            var lc = links.length;
            for (var l = 0; l < lc; l++) {
                var link = links[l];
                message += "<u>" + link.fromProtein.name + " - " + link.toProtein.name + "</u><br/>"
                //inter protein res links
                var c2 = link.residueLinks.values().length;
                var lcount = 0;
                for (var rl = 0; rl < c2; rl++) {
                    var set1 = false;
                    var set2 = false;
                    var set3 = false;

                    var resLink = link.residueLinks.values()[rl];
                    var count = resLink.matches.length;
                    for (var i = 0; i < count; i++) {
                        var match = resLink.matches[i];
                        if (match.search_id == PV.set1)
                            set1 = true;
                        else if (match.search_id == PV.set2)
                            set2 = true;
                        else if (match.search_id == PV.set3)
                            set3 = true;
                    }
                    if (set1 && !set2 && !set3)
                        set1Links.push(resLink);
                    else
                    if (!set1 && set2 && !set3)
                        set2Links.push(resLink);
                    else
                    if (!set1 && !set2 && set3)
                        set3Links.push(resLink);
                    else
                        nonuniqueLinks.push(resLink);
                }
            }

            set1Links.sort(function(a, b) {
                var result = (a.fromResidue - 0) - (b.fromResidue - 0);
                if (result === 0) {
                    result = (a.toResidue - 0) - (b.toResidue - 0)
                }
                return result;
            });
            set2Links.sort(function(a, b) {
                var result = (a.fromResidue - 0) - (b.fromResidue - 0);
                if (result === 0) {
                    result = (a.toResidue - 0) - (b.toResidue - 0)
                }
                return result;
            });

            set3Links.sort(function(a, b) {
                var result = (a.fromResidue - 0) - (b.fromResidue - 0);
                if (result === 0) {
                    result = (a.toResidue - 0) - (b.toResidue - 0)
                }
                return result;
            });

            nonuniqueLinks.sort(function(a, b) {
                var result = (a.fromResidue - 0) - (b.fromResidue - 0);
                if (result === 0) {
                    result = (a.toResidue - 0) - (b.toResidue - 0)
                }
                return result;
            });

            var message = "<br/><strong>Search ID: " + PV.set1 + " only (" + set1Links.length + " links)</strong><br/><br/>";
            var c2 = set1Links.length;
            for (var rl = 0; rl < c2; rl++) {
                var resLink = set1Links[rl];
                message += resLink.fromProtein.name.substring(0, 4) + ", <strong>" + resLink.fromResidue + "</strong> (" + link.fromProtein.sequence[resLink.fromResidue - 1]
                        + ") - "
                        + resLink.toProtein.name.substring(0, 4) + ", <strong>" + resLink.toResidue + "</strong> (" + link.toProtein.sequence[resLink.toResidue - 1] + "), " + "";

                message += resLink.matches[0].pep1Seq + " to " + resLink.matches[0].pep2Seq + "</br>";


            }

            message += "<br/><strong>Search ID: " + PV.set2 + " only (" + set2Links.length + " links)</strong><br/><br/>";
            var c2 = set2Links.length;
            for (var rl = 0; rl < c2; rl++) {
                var resLink = set2Links[rl];
                message += resLink.fromProtein.name.substring(0, 4) + ", <strong>" + resLink.fromResidue + "</strong> (" + link.fromProtein.sequence[resLink.fromResidue - 1]
                        + ") - "
                        + resLink.toProtein.name.substring(0, 4) + ", <strong>" + resLink.toResidue + "</strong> (" + link.toProtein.sequence[resLink.toResidue - 1] + "), " + "";

                message += resLink.matches[0].pep1Seq + " to " + resLink.matches[0].pep2Seq + "</br>";
            }

            message += "<br/><strong>Search ID: " + PV.set3 + " only (" + set3Links.length + " links)</strong><br/><br/>";
            var c2 = set3Links.length;
            for (var rl = 0; rl < c2; rl++) {
                var resLink = set3Links[rl];
                message += resLink.fromProtein.name.substring(0, 4) + ", <strong>" + resLink.fromResidue + "</strong> (" + link.fromProtein.sequence[resLink.fromResidue - 1]
                        + ") - "
                        + resLink.toProtein.name.substring(0, 4) + ", <strong>" + resLink.toResidue + "</strong> (" + link.toProtein.sequence[resLink.toResidue - 1] + "), " + "";

                message += resLink.matches[0].pep1Seq + " to " + resLink.matches[0].pep2Seq + "</br>";
            }



            message += "<br/><strong>Non-unique - multiple searches (" + nonuniqueLinks.length + " links)</strong><br/><br/>";
            var c2 = nonuniqueLinks.length;
            for (var rl = 0; rl < c2; rl++) {
                var resLink = nonuniqueLinks[rl];
                message += resLink.fromProtein.name.substring(0, 4) + ", <strong>" + resLink.fromResidue + "</strong> (" + link.fromProtein.sequence[resLink.fromResidue - 1]
                        + ") - "
                        + resLink.toProtein.name.substring(0, 4) + ", <strong>" + resLink.toResidue + "</strong> (" + link.toProtein.sequence[resLink.toResidue - 1] + "), " + "";

                message += resLink.matches[0].pep1Seq + " to " + resLink.matches[0].pep2Seq + "</br>";
            }
            PV.message(message);
        }
        else
        {
            var message = "Search ID: " + PV.sid + "<br/><br/>CUTOFF:" + PV.cutOff + "<br/><br/>";
            var links = XiPV.proteinLinks.values();
            var lc = links.length;
            for (var l = 0; l < lc; l++) {
                var link = links[l];
                //            if (link.fromProt != link.toProt){
                message += "<u>" + link.fromProtein.name + " - " + link.toProtein.name + "</u><br/><br/>"
                            +"FromProtein, FromResidue, FromAA, ToProtein, ToResidue, ToAA, HighestScore, NumberMatches, Distance<br/>";
                //inter protein res links
                var c2 = link.residueLinks.values().length;
                var lcount = 0;
                for (var rl = 0; rl < c2; rl++) {
                    var resLink = link.residueLinks.values()[rl];
                    var matchFound = false;

                    var scans = "[scan numbers:";
                    var count = resLink.matches.length;

                    var highestScore = 0;
                    var noMatches = 0;
                    var d;
                    if (typeof XiPV.shortestDists !== 'undefined') {d = XiPV.shortestDists[resLink.id];}
                    for (var i = 0; i < count; i++) {
                        var match = resLink.matches[i];
                        if (match.check()) {
                            noMatches++;
                            
                            if (match.score > highestScore) {
                                highestScore = match.score;
                            }
                            
                            if (matchFound)
                                scans += ", ";
                            else
                                matchFound = true;
                            scans += match.scan_no;
                        }
                    }
                    if (matchFound) {
                        message += link.fromProtein.name + ", " + resLink.fromResidue + ", " + link.fromProtein.sequence[resLink.fromResidue - 1]
                                + ", "
                                + link.toProtein.name + ", " + resLink.toResidue + ", " + link.toProtein.sequence[resLink.toResidue - 1] + ", " + highestScore + ", " + noMatches + ", " + d + "<br/>";
                        lcount++;
                    }
                }
                message += "<br/><br/>(" + lcount + " unique links)<br/><br/>";
                //            }
            }
            PV.message(message);
        }
        /*        function appendLinkSummary(link){
         var aboveSevenMatchFound = false;
         var scans = "[scan numbers:";
         var count = link.matches.length;
         for (var i=0; i < count; i++) {
         var match = link.matches[i];
         //                if (match.score > 7.0) {
         if (aboveSevenMatchFound) scans += ", ";
         else aboveSevenMatchFound = true;
         scans += match.scan_no;
         //                }
         }
         if (aboveSevenMatchFound){
         message += link.id + " " + scans + "]<br/>";
         intraCount++;
         }
         }*/
    }

    function PV_residueInfo() {
        var message = "<h2>Summary of linked residues (currently ignores score cut-off)</h2>";
        var resTypes = {};
        var resPairTypes = {};

        var prots = XiPV.proteins.values();
        var proteinCount = prots.length;
        for (var p = 0; p < proteinCount; p++) {
            var protein = prots[p];
            //            var intraCount = 0;

            var proteinSelfLink = XiPV.proteinLinks.get(protein.id + "-" + protein.id);
            if (proteinSelfLink != undefined) {
                //        alert("in");
                var internalLinks = proteinSelfLink.residueLinks.values();
                var iLinkCount = internalLinks.length;
                for (var l = 0; l < iLinkCount; l++) {

                    //                    intraCount++;
                    var intLink = internalLinks[l];
                    var res1 = protein.sequence[intLink.fromResidue - 1];
                    var res2 = protein.sequence[intLink.toResidue - 1];
                    if (res2 < res1) {
                        var temp = res1;
                        res1 = res2;
                        res2 = temp;
                    }
                    var resPairKey = res1 + '-' + res2;
                    var resPairCount = resPairTypes[resPairKey];
                    if (resPairCount == undefined) {
                        resPairCount = {key: resPairKey, lnkCnt: 0, links: {}};
                        resPairTypes[resPairKey] = resPairCount;
                    }
                    resPairCount["lnkCnt"]++;
                    //                    addLinkSummary(intLink, resPairCount["links"]);

                    var res1Count = resTypes[res1];
                    if (res1Count == undefined) {
                        res1Count = {key: res1, lnkCnt: 0, links: {}};
                        resTypes[res1] = res1Count;
                    }
                    res1Count["lnkCnt"]++;
                    //                    addLinkSummary(intLink, res1Count["links"]);

                    var res2Count = resTypes[res2];
                    if (res2Count == undefined) {
                        res2Count = {key: res2, lnkCnt: 0, links: {}};
                        resTypes[res2] = res2Count;
                    }

                    res2Count["lnkCnt"]++;
                    //                    addLinkSummary(intLink, res2Count["links"]);
                }
            }
        }



        var links = XiPV.proteinLinks.values();
        var linkCount = links.length;
        for (var l = 0; l < linkCount; l++) {
            var link = links[l];
            if (link.fromProtein != link.toProtein) {
                //                            message += "<u>Inter protein links:"+link.id+"</u><br/><br/>"
                //inter protein res links
                var c2 = link.residueLinks.values().length;
                var interCount = 0;
                for (var rl = 0; rl < c2; rl++) {
                    var resLink = link.residueLinks.values()[rl];
                    var res1 = resLink.fromProtein.sequence[resLink.fromResidue - 1];
                    var res2 = resLink.toProtein.sequence[resLink.toResidue - 1];
                    if (res2 < res1) {
                        var temp = res1;
                        res1 = res2;
                        res2 = temp;
                    }
                    var resPairKey = res1 + '-' + res2;
                    var resPairCount = resPairTypes[resPairKey];
                    if (resPairCount == undefined) {
                        resPairCount = {key: resPairKey, lnkCnt: 0, links: {}};
                        resPairTypes[resPairKey] = resPairCount;
                    }
                    resPairCount["lnkCnt"]++;
                    //                                    addLinkSummary(intLink, resPairCount["links"]);

                    var res1Count = resTypes[res1];
                    if (res1Count == undefined) {
                        res1Count = {key: res1, lnkCnt: 0, links: {}};
                        resTypes[res1] = res1Count;
                    }
                    res1Count["lnkCnt"]++;
                    //                addLinkSummary(resLink, res1Count["links"]);

                    var res2Count = resTypes[res2];
                    if (res2Count == undefined) {
                        res2Count = {key: res2, lnkCnt: 0, links: {}};
                        resTypes[res2] = res2Count;
                    }

                    res2Count["lnkCnt"]++;
                    //                addLinkSummary(resLink, res2Count["links"]);}
                    //                            message += " (" + interCount + " unique links)<br/>";
                }
            }
        }

        //            message += "<u>"+ protein.name + " <b>(" + intraCount + " unique internal links)</b></u><br/><br/> ";
        //            var table1 = "<table><tr><th>Residue Pairs</th><th>#Unique links</th>"
        //                + "<th>Links</th><th>Details</th></tr>\n";
        //            message += getTableFromResTypeObj(resPairTypes, table1);// + '<pre>' + JSON.stringify(resTypes, null, '\t') + '</pre>';

        message += getTableFromResTypeObj(resPairTypes);
        message += '<br/>';
        message += getTableFromResTypeObj(resTypes);// + '<pre>' + JSON.stringify(resTypes, null, '\t') + '</pre>';


        PV.message(message);
        //
        function addLinkSummary(link, linkInfo) {
            var mCount = link.matches.length;
            var summary = link.id + " (" + mCount + " matches), scans: ";

            var lnkMatches = new Array();
            for (var i = 0; i < mCount; i++) {
                var match = link.matches[i];
                lnkMatches.push({scan_no: match.scan_no,
                    score: roundNumber(match.score, 3),
                    auto: match.autovalidated,
                    val: match.validated});
            }
            lnkMatches.sort(function(a, b) {
                return b["score"] - a["score"]
            });
            linkInfo[link.id] = lnkMatches;
        }
        //
        function getTableFromResTypeObj(resTypes) {
            var sortable = toArray(resTypes);
            sortable.sort(function(a, b) {
                return b["lnkCnt"] - a["lnkCnt"]
            });
            //
            var table = "<table><tr><th>Residue</th><th>#occurences in unique links</th></tr>\n";

            //
            for (var i = 0; i < sortable.length; i++) {
                var resPairRowCount = 0;
                var resPair = sortable[i];
                var uLnkCount = resPair.lnkCnt;
                table += "<tr><td>"
                        + resPair.key + "</td>"
                        + "<td>"
                        + resPair.lnkCnt + "</td></tr>";
                //                var first = true;
                //                var rCnt = 0;
                //                for (var lnk in resPair["links"]){
                //                    rCnt++;
                //                    var linkDetails = resPair["links"][lnk];
                //                    if (!first) table += "<tr>";
                //                    else first = false;
                //                    table += "<td>"+lnk+"</td><td>";
                //                    var summary = "<b>" + linkDetails.length + " matches.</b> Scans[score]:"
                //                    for (var l = 0; l < linkDetails.length; l++){
                //                        var m = linkDetails[l];
                //                        summary += " #" + m.scan_no + " [" + m.score + "] ";
                //                    }
                //                    table += summary + "</td></tr>";
                //                }
                //                for (var thisCodeIsTerrible = 0; thisCodeIsTerrible < (uLnkCount - rCnt); thisCodeIsTerrible++){
                //                    table += "<tr><td></td><td></td></tr>";
                //                }
                //                table += "</td></tr>";
            }
            table += "</table>";
            return table;// + '<pre>' + JSON.stringify(sortable, null, '\t') + '</pre>';
        }
        //
        function toArray(obj) {
            var arr = new Array();
            for (var key in obj) {
                if (obj.hasOwnProperty(key)) {
                    arr.push(obj[key]);
                }
            }
            return arr;
        }
    }


    //]]></script>
            
            
		<script type="text/javascript">
                //<![CDATA[			
				function initSlider(){
					if (xlv.scores != null){
						document.getElementById('scoreLabel1').innerHTML = xlv.scores.min.toFixed(2);
						document.getElementById('scoreLabel2').innerHTML = xlv.scores.max.toFixed(2) + '&nbsp;&nbsp;';
						document.getElementById('debug1').innerHTML = 'Cut-Off:' + xlv.scores.min.toFixed(2);
						new Control.Slider('handle1', 'track1', {
							sliderValue: 0,
							onSlide: function(v) {
								var cut = calcCutOff(v);
								document.getElementById('debug1').innerHTML = 'Cut-Off: ' + cut;
								xlv.setCutOff(cut);
							},
							onChange: function(v) {
								var cut = calcCutOff(v);
								document.getElementById('debug1').innerHTML = 'Cut-Off: ' + cut;
								xlv.setCutOff(cut);
							}
						});
						function calcCutOff(v) {
							var result = (v * (xlv.scores.max - xlv.scores.min)) + xlv.scores.min;
							result = result.toFixed(2);
							return result;
						}
					}
					else {
						//no score
						document.getElementById('scoreSlider').setAttribute("style", "display:none;");
					}
				}
				
				initSlider();				
                //]]>
        </script>
		<script type="text/javascript">
				//<![CDATA[
				helpShown = false;
				infoShown = false;
				function toggleHelpPanel() {
					if (helpShown){
						hideHelpPanel();
					}
					else {
						showHelpPanel();
					}
				}
				
				function toggleInfoPanel() {
					if (infoShown){
						hideInfoPanel();
					}
					else {
						showInfoPanel();
					}
				}
				
				function showHelpPanel() {
						helpShown = true;
						d3.select("#helpPanel").style('display','block');
						d3.select("#helpPanel").transition().style("top", "0%").duration(700);
						d3.select(".help").attr('class', "btn help");
				}
				function hideHelpPanel() {
						helpShown = false;
						d3.select("#helpPanel").transition().style("top", "100%").duration(700);
						d3.select("#helpPanel").transition().style('display','none').delay(700);;
						d3.select(".help").attr('class', "btn btn-inverse help");
				}
				function showInfoPanel() {
						infoShown = true;
						d3.select("#infoPanel").style('display','block');
						d3.select("#infoPanel").transition().style("top", "0%").duration(700);
						d3.select(".info").attr('class', "btn info");	
				}
				function hideInfoPanel() {
						infoShown = false;
						d3.select("#infoPanel").transition().style("top", "100%").duration(700);
						d3.select("#infoPanel").transition().style('display','none').delay(700);;
						d3.select(".info").attr('class', "btn btn-inverse info");
				}
				//]]>
		</script>
    

</body></html>
